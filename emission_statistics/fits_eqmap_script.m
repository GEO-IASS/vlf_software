function fits_eqmap_script
% Runs IDL on a bunch of fits files to equatorially map them

root_dir = '/home/dgolden/vlf/case_studies/image_euv_2001/fits';

sub_dirs = {...
'2001-04-08',...
'2001-04-09',...
'2001-04-10',...
'2001-04-11',...
'2001-04-12',...
'2001-04-13',...
'2001-04-14',...
'2001-04-15',...
'2001-04-16',...
'2001-04-17',...
'2001-04-18',...
'2001-04-19',...
'2001-04-20',...
'2001-04-21',...
'2001-04-22',...
'2001-04-23',...
'2001-04-24',...
'2001-04-25',...
'2001-04-26',...
'2001-04-27',...
'2001-04-28',...
'2001-04-29',...
'2001-04-30',...
};

original_dir = pwd;

try
	for kk = 1:length(sub_dirs)
		cd(fullfile(root_dir, sub_dirs{kk}));
		fid = fopen('center.txt', 'r');
		center = fscanf(fid, '%d, %d');
		cd('original');
		eval(sprintf('!idl -e ''xform, center = [%d, %d], mxl = 6, /mlt, /all''', center(1), center(2)));
		mkdir('../eqmapped');
		movefile('*.mtx', '../eqmapped');
		movefile('*.png', '../eqmapped');
		movefile('*shadowmask.fits', '../eqmapped');
		movefile('*xform.fits', '../eqmapped');
	end
catch err
	cd(original_dir);
	rethrow(err);
end
